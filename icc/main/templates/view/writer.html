{% extends "base.html" %}

{% block content %}
    <div class="toolbar">
        <div class="tools">
            <a href="{{ url_for("main.writer_annotations", writer_url=writer.url_name) }}">
                view annotations
            </a>
            <a href="{{ url_for("user.follow_writer", writer_id=writer.id, next=request.full_path) }}">
                {% if current_user.is_authenticated and writer in current_user.followed_writers %}unfollow{% else %}follow{% endif %}
            </a>
            <a href="{{ url_for("main.edit_wiki", wiki_id=writer.wiki.id, next=request.full_path) }}">
                edit wiki
            </a>
            <a href="{{ url_for("main.wiki_edit_history", wiki_id=writer.wiki.id) }}">
                wiki edit history
            </a>
        </div>
    </div>
    <h1>{{ writer.name }}
        {% if writer.birth_date.year %}
                ({{ writer.birth_date.year }}-{{ writer.death_date.year }})
        {% endif %}
    </h1>

    <div id="bio">{{ writer.wiki.current.body|markdown }}</div>

    {% for category, works in writer.works.items() %}
        <h2>{{ category.title() }} &times; {{ len(writer.works) }}</h2>
            <div class="index">
                {% for edition in works %}
                    <div class="card">
                        <h3 class="title">
                            <a href="{{ edition.url }}">
                                {{ edition.title }}
                            </a>
                        </h3>
                        <div class="count">
                            &times; <em>{{ edition.lines.count() }} ll.</em>
                        </div>

                        {# Display the wiki of the text if this is the primary
                        edition, else the wiki of the edition. #}
                        {% if edition.primary %}
                            {% set wiki = edition.text.wiki %}
                        {% else %}
                            {% set wiki = edition.wiki %}
                        {% endif %}
                        <div{% if len(wiki.current.body) >= 127 %}
                            class="card_text_cutoff"{% endif %}>
                            {{ wiki.current.body[:127]|markdown }}</div>

                        <div class="viewmore">
                            <a href="{{ edition.url }}">View More</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
    {% endfor %}
{% endblock %}
