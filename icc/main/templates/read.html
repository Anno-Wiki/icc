{% extends "base.html" %}

{% block content %}
    {# Header/Running Head #}
    {% set writers = edition.writers['author'] %}
    <h1>
        <a href="{{ edition.url }}">{{ edition.title }}</a>
        by {% include "includes/_writers_list.html" %} &#167; {{ section }}
    </h1>

    {# Pagination #}
    {% if prev_page %}
        <a href="{{ prev_page }}">&lt;&lt; Previous Page</a>
    {% endif %}

    {% if prev_page and next_page %}|{% endif %}

    {% if next_page %}
        <a href="{{ next_page }}">Next Page &gt;&gt;</a>
    {% endif %}


    {# Line number entry for annotation form #}
    <form class="body-form" id="line-form" action="" method="POST">
        {{ form.hidden_tag() }}
        {{ form.first_line(class_="hideme") }}
        {{ form.last_line(class_="hideme") }}
        {{ form.first_char(class_="hidden") }}
        {{ form.last_char(class_="hidden") }}
        {{ form.submit() }}
    </form>
    <div onclick="submit();" id="annotate-button">annotate</div>

    {# hide the line number form from javascript users. #}
    <script>
        var hideform = document.getElementById('line-form');
        hideform.classList.add('js')
    </script>

    <hr>

    {# Text of the page #}
    {% include "includes/js/_highlight.js" %}
    {% include "includes/js/_annotation_display.js" %}

    <div id="text-content">
        {%- for line in lines %}
            {% if line.primary.enum == "fl" %}<div class="break"></div>{% endif %}

            <div class="line {{ line.primary.enum }}" id="{{ line.num }}">
                <span class="line-num{% if line.num % 5 != 0 %} hidden{% endif %}">{{ line.num }}</span>
                {%- if line.primary.enum == 'hr' -%}
                    <hr>
                {%- else -%}
                    <span class="text">{{ line.line|safe }}</span>
                {%- endif -%}
                {% if line.num in annotations_idx %}
                    <span class="line-annotations">
                        {% for a in annotations_idx[line.num] %}
                        <a class="annotation-link" onclick="show_annotation(this);" href="#a{{ a.id }}"><sup>[{{ a.id }}]</sup></a>
                        {% endfor %}
                    </span>
                {% endif %}

            </div>

        {% endfor %}
    </div>

    {% include "includes/js/_collapse_script.js" %}
    {% if annotations_idx %}
        {% for i in range(lines[0].num, lines[-1].num) %}
                {% for annotation in annotations_idx[i] %}
                    {% include "includes/_annotation.html" %}
                {% endfor %}
        {% endfor %}
    {% else %}
        <h4>There are no annotations for this section.</h4>
    {% endif %}
{% endblock %}
