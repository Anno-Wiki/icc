{% extends "base.html" %}

{% block content %}

    <script src="{{ url_for("static", filename="scripts/tags.js") }}"></script>
    <!--Header/Running Head-->
    <div class="running_head">
        <a href="{{ edition.url }}"> {{ edition.title }} </a>
        {% set writers = edition.writers['author'] %}
        by {% include "includes/_writers_list.html" %}
    </div>

    <hr>

    <div id="text-content">
        {% if annotation %}
            <h1>Editing Annotation [{{ annotation.id }}] on {{ edition.title }}</h1>
        {% else %}
            <h1>Annotating {{ edition.title }}</h1>
        {% endif %}
        {% if len(lines) > 1 %}
            <h3>Selection: <em>ll. {{ lines[0].num }}-{{ lines[-1].num }}</em></h3>
        {% else %}
            <h3>Selection: <em>l. {{ lines[0].num }}</em></h3>
        {% endif %}

        {% for line in context %}
            <div class="line {{ line.primary.enum }}" id="{{ line.num }}">
                <span class="line-num{% if line not in lines %} hidden{% endif %}">{{ line.num }}</span>
                <span class="text">{{ line.line }}</span>
            </div>
        {% endfor %}
    </div>

    <br><br>
    <form class="body-form" action="" method="POST" novalidate>
        {{ form.csrf_token }}
        <span style="display:none;">
            {{ form.first_char_idx }}
            {{ form.last_char_idx }}
        </span>
        <table>
            <tr>
                <th>
                    {{ form.first_line.label }}:
                    {{ form.first_line }}
                    <br>
                    {% for error in form.first_line.errors %}
                        <span style="color: red;"> [{{ error }}] </span>
                    {% endfor %}
                </th>
                <th>
                    {{ form.last_line.label }}:
                    {{ form.last_line }}
                    <br>
                    {% for error in form.last_line.errors %}
                        <span style="color: red;"> [{{ error }}] </span>
                    {% endfor %}
                </th>
            </tr>

            <tr>
                <td colspan=5>
                    <strong>{{ form.annotation.label }}</strong>
                    <br>
                    {{ form.annotation }}
                    <br>
                </td>
            </tr>

            <tr>
                <td colspan=5>
                    <strong>{{ form.tags.label }}</strong>
                    <br>

                    <div id="master_div">
                        {# tag spans is where we put the tags as they're
                            created by the javascript #}
                        <div id="tag_spans"></div>
                        <div id="input">{{ form.tags }}</div>
                    </div>
                    <div id="autocomplete"></div>

                    {% for error in form.tags.errors %}
                        <span style="color: red;">[{{ error }}]</span>
                        <br>
                    {% endfor %}
                </td>
            </tr>

            {% if annotation %}
                <tr>
                    <td colspan=5>
                        <strong>{{ form.reason.label }}</strong>
                        <br>
                        {{ form.reason }}
                        {% for error in form.reason.errors %}
                            <span style="color: red;"> [{{ error }}] </span>
                        {% endfor %}
                    </td>
                </tr>
            {% endif %}

            <tr>
                <th colspan=5>{{ form.submit }}</th>
            </tr>
        </table>
    </form>
{% endblock %}
