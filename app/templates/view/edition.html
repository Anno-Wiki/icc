{% extends "base.html" %}

{% block content %}
<h1>
    <a href="{{ url_for("text", text_url=edition.text.url) }}">
        {{ edition.text.title }}
    </a>
    {% if edition.primary %}
    *
    {% endif %}
</h1>
<h2>
    by
    {% if len(edition.text.authors) == 2 %}
        <a href="{{ url_for("writer", writer_url=edition.text.authors[0].url) }}">
            {{ edition.text.authors[0].name }}
        </a>
        and
        <a href="{{ url_for("writer", writer_url=edition.text.authors[1].url) }}">
            {{ edition.text.authors[1].name }}
        </a>
    {% elif len(edition.text.authors) == 1 %}
        <a href="{{ url_for("writer", writer_url=edition.text.authors[0].url) }}">
            {{ edition.text.authors[0].name }}
        </a>
    {% elif len(edition.text.authors) == 0 %}
        Unattributed
    {% else %}
        {% for author in edition.text.authors %}
            {% if author == edition.text.authors[-1]
                and author != edition.text.authors[0] %}
                and
            {% endif %}
            <a href="{{ url_for("writer", writer_url=author.url) }}">
                {{ author.name }}
            </a>
            {% if author != edition.text.authors[-1] %}
                , 
            {% endif %}
        {% endfor %}
    {% endif %}
</h2>
<br>
<h2>
    Edition #{{ edition.num }}
</h2>
{% if edition.translators %}
    <h3>
        translated by
        {% if len(edition.translators) == 2 %}
            <a href="{{ url_for("writer", writer_url=edition.translators[0].url) }}">
                {{ edition.translators[0].name }}
            </a>
            and
            <a href="{{ url_for("writer", writer_url=edition.translators[1].url) }}">
                {{ edition.translators[1].name }}
            </a>
        {% elif len(edition.translators) == 1 %}
            <a href="{{ url_for("writer", writer_url=edition.translators[0].url) }}">
                {{ edition.translators[0].name }}
            </a>
        {% elif len(edition.translators) == 0 %}
            Unattributed
        {% else %}
            {% for translator in edition.translators %}
                {% if translator == edition.translators[-1]
                    and translator != edition.translators[0] %}
                    and
                {% endif %}
                <a href="{{ url_for("writer", writer_url=translator.url) }}">
                    {{ translator.name }}
                </a>
                {% if translator != edition.translators[-1] %}
                    , 
                {% endif %}
            {% endfor %}
        {% endif %}
    </h3>
{% endif %}
{% if edition.editors %}
    <h3>
        translated by
        {% if len(edition.editors) == 2 %}
            <a href="{{ url_for("writer", writer_url=edition.editors[0].url) }}">
                {{ edition.editors[0].name }}
            </a>
            and
            <a href="{{ url_for("writer", writer_url=edition.editors[1].url) }}">
                {{ edition.editors[1].name }}
            </a>
        {% elif len(edition.editors) == 1 %}
            <a href="{{ url_for("writer", writer_url=edition.editors[0].url) }}">
                {{ edition.editors[0].name }}
            </a>
        {% elif len(edition.editors) == 0 %}
            Unattributed
        {% else %}
            {% for editor in edition.editors %}
                {% if editor == edition.editors[-1]
                    and editor != edition.editors[0] %}
                    and
                {% endif %}
                <a href="{{ url_for("writer", writer_url=editor.url) }}">
                    {{ editor.name }}
                </a>
                {% if editor != edition.editors[-1] %}
                    , 
                {% endif %}
            {% endfor %}
        {% endif %}
    </h3>
{% endif %}


<div id="summary">{{ edition.history|markdown }}</div>

<a href="{{ url_for("edition_annotations", text_url=edition.text.url,
    edition_num=edition.num) }}">
    view all annotations
</a>

{% if current_user.is_authenticated %}
    {% if current_user.is_authorized("edit_edition_histories") %}
        |
        <a href="{{ url_for("admin.edit_edition_history", edition_id=edition.id,
            next=request.full_path) }}">
            edit
        </a>
    {% endif %}
{% endif %}

{# table of contents #}
<table class="table_of_contents">
    <tr class="toc_header">
        <th align="left">Section</th>
        <th align="center">Section Title</th>
        <th align="right">Line</th>
    </tr>
    {% for section in hierarchy %}
        {% if section.label.label == "lvl1" %}
            <tr class="lvl1_contents">
                <td align="left">
                    <a href="{{ section.get_url() }}">
                        {{ section.label.display }} {{ section.lvl1 }}
                    </a>
                </td>
                <td>
                    <a href="{{ section.get_url() }}">
                        {{ section.line }}
                    </a>
                </td>
                <td align="right">
                    <a href="{{ section.get_url() }}"> {{ section.num }} </a>
                </td>
            </tr>
        {% elif section.label.label == "lvl2" %}
            <tr class="lvl2_contents">
                <td align="left">
                    <a href="{{ section.get_url() }}">
                        {{ section.label.display }} {{ section.lvl2 }}
                    </a>
                </td>
                <td align="center">
                    <a href="{{ section.get_url() }}">
                        {{ section.line }}
                    </a>
                </td>
                <td align="right">
                    <a href="{{ section.get_url() }}"> {{ section.num }} </a>
                </th>
            </tr>
        {% elif section.label.label == "lvl3" %}
            <tr class="lvl3_contents">
                <td align="left">
                    <a href="{{ section.get_url() }}">
                        {{ section.label.display }} {{ section.lvl3 }}
                    </a>
                </td>
                <td align="center">
                    <a href="{{ section.get_url() }}">
                        {{ section.line }}
                    </a>
                </td>
                <td align="right">
                    <a href="{{ section.get_url() }}"> {{ section.num }} </a>
                </th>
            </tr>
        {% elif section.label.label == "lvl4" %}
            <tr class="lvl4_contents">
                <td align="left">
                    <a href="{{ section.get_url() }}">
                        {{ section.label.display }} {{ section.lvl4 }}
                    </a>
                </td>
                <td align="center">
                    <a href="{{ section.get_url() }}">
                        {{ section.line }}
                    </a>
                </td>
                <td align="right">
                    <a href="{{ section.get_url() }}"> {{ section.num }} </a>
                </th>
            </tr>
        {% endif %}
    {% endfor %}
</table>
{% endblock %}
