{% extends "base.html" %}

{% block content %}
<div id="content">
    <h1>Annotation {{ edit.pointer.id }} of {{ edit.book.title }}</h1>
    <h2>Initial Version</h2>
    <em>
        <a href="{{ url_for("edit_history", annotation_id=edit.pointer.id) }}">
            version history
        </a>
    </em>

    <div class="diff">
        <p><em>Line selection:</em></p>
        {% for line in edit.context %}
            {% if line in edit.lines %}
                <span class="linenum">{{ line.line_num }}</span>
                <line id="{{ line.line_num }}" class="plus">
                    {{ line.line }}
                </line>
            {% else %}
                <line id="{{ line.line_num }}"> 
                    {{ line.line }}
                </line>
            {% endif %}
        {% endfor %}
    </div>
    <br>
    <p><em>Annotation:</em></p>
    <annotation id="difference">
        <div class="annotation_head">
            Annotation
            <sup>
                <a href="{{ url_for("annotation", annotation_id=edit.pointer.id)
                    }}">
                    [{{ edit.pointer.id }}]
                </a>
            </sup>
            on
            <em>
                <a href="{{ edit.lines[0].get_url() }}#{{ edit.first_line_num
                    }}">
                    {%- if edit.first_line_num == edit.last_line_num %}
                        l.{{ edit.last_line_num }}
                    {% else %}
                        ll.{{ edit.first_line_num }}-{{ edit.last_line_num }}
                    {% endif %}
                </a>
            </em>

            {% if edit.pointer.locked %}
                &#128274;
            {% endif %}
        </div>

        <div class="annotation_content">
            <div class="diff">
                <div class="plus">{{ edit.annotation|markdown }}</div>
            </div>
        </div>

        <tags>
            {% for tag in edit.tags %}
                <a href="{{ url_for("tag", tag=tag.tag) }}">
                    <tag class="plus">
                        + {{ tag.tag }}
                    </tag>
                </a>
            {% endfor %}
        </tags>

        <br> 

        <!--annotation authorship-->
        <em>
            <a href="{{ url_for("annotation", annotation_id=edit.pointer.id)
                }}">
                annotated
            </a>
            by
        </em>
        <a href="{{ url_for("user", user_id=edit.pointer.author.id) }}">
            {{ edit.pointer.author.displayname }}
        </a>
        {{ edit.pointer.added }}
    </annotation>
    
</div>
{% endblock %}
