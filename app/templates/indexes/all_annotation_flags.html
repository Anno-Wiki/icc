{% extends "base.html" %}

{% block content %}

{% if flags %}
    <table class="inbox">
        <tr class="header">
            {% if sort == "marked" %}
                <th class="highlight">
                    <a href="{{ sorts["marked_invert"] }}">
                        &#9662;
                    </a>
                </th>
            {% elif sort == "marked_invert" %}
                <th class="highlight">
                    <a href="{{ sorts["marked"] }}">
                        &#9652;
                    </a>
                </th>
            {% else %}
                <th>
                    <a href="{{ sorts["marked"] }}">
                        &nbsp;
                    </a>
                </th>
            {% endif %}

            {% if sort == "annotation" %}
                <th class="highlight">
                    <a href="{{ sorts["annotation_invert"] }}">
                        [id] &#9662;
                    </a>
                </th>
            {% elif sort == "annotation_invert" %}
                <th class="highlight">
                    <a href="{{ sorts["annotation"] }}">
                        [id] &#9652;
                    </a>
                </th>
            {% else %}
                <th>
                    <a href="{{ sorts["annotation"] }}">
                        [id]
                    </a>
                </th>
            {% endif %}

            {% if sort == "book" %}
                <th class="highlight">
                    <a href="{{ sorts["book_invert"] }}">
                        Book &#9662;
                    </a>
                </th>
            {% elif sort == "book_invert" %}
                <th class="highlight">
                    <a href="{{ sorts["book"] }}">
                        Book &#9652;
                    </a>
                </th>
            {% else %}
                <th>
                    <a href="{{ sorts["book"] }}">
                        Book
                    </a>
                </th>
            {% endif %}


            {% if sort == "flag" %}
                <th class="highlight">
                    <a href="{{ sorts["flag_invert"] }}">
                        Flag &#9662;
                    </a>
                </th>
            {% elif sort == "flag_invert" %}
                <th class="highlight">
                    <a href="{{ sorts["flag"] }}">
                        Flag &#9652;
                    </a>
                </th>
            {% else %}
                <th>
                    <a href="{{ sorts["flag"] }}">
                        Flag
                    </a>
                </th>
            {% endif %}

            {% if sort == "time" %}
                <th class="highlight">
                    <a href="{{ sorts["time_invert"] }}">
                        Time &#9662;
                    </a>
                </th>
            {% elif sort == "time_invert" %}
                <th class="highlight">
                    <a href="{{ sorts["time"] }}">
                        Time &#9652;
                    </a>
                </th>
            {% else %}
                <th>
                    <a href="{{ sorts["time"] }}">
                        Time
                    </a>
                </th>
            {% endif %}

            {% if sort == "thrower" %}
                <th class="highlight">
                    <a href="{{ sorts["thrower_invert"] }}">
                        Thrower &#9662;
                    </a>
                </th>
            {% elif sort == "thrower_invert" %}
                <th class="highlight">
                    <a href="{{ sorts["thrower"] }}">
                        Thrower &#9652;
                    </a>
                </th>
            {% else %}
                <th>
                    <a href="{{ sorts["thrower"] }}">
                        Thrower
                    </a>
                </th>
            {% endif %}

            {% if sort == "resolver" %}
                <th class="highlight">
                    <a href="{{ sorts["resolver_invert"] }}">
                        Resolver &#9662;
                    </a>
                </th>
            {% elif sort == "resolver_invert" %}
                <th class="highlight">
                    <a href="{{ sorts["resolver"] }}">
                        Resolver &#9652;
                    </a>
                </th>
            {% else %}
                <th>
                    <a href="{{ sorts["resolver"] }}">
                        Resolver
                    </a>
                </th>
            {% endif %}

            {% if sort == "resolved_at" %}
                <th class="highlight">
                    <a href="{{ sorts["resolved_at_invert"] }}">
                        Resolve Time &#9662;
                    </a>
                </th>
            {% elif sort == "resolved_at_invert" %}
                <th class="highlight">
                    <a href="{{ sorts["resolved_at"] }}">
                        Resolve Time &#9652;
                    </a>
                </th>
            {% else %}
                <th>
                    <a href="{{ sorts["resolved_at"] }}">
                        Resolve Time
                    </a>
                </th>
            {% endif %}
        </tr>

        {% for flag in flags %}

            {% if flag.resolved %}
            <tr class="read">
            {% else %}
            <tr class="unread">
            {% endif %}

                <td>
                    <a href="{{ url_for("mark_annotation_flag", flag_id=flag.id,
                        next=request.full_path) }}">
                        {% if flag.resolved_by %}
                        &#10003;
                        {% else %}
                        &#10007;
                        {% endif %}
                    </a>
                </td>

                <td>
                    <a href="{{ url_for("annotation",
                        annotation_id=flag.annotation.id) }}">
                        [{{ flag.annotation.id }}]
                    </a>
                </td>

                <td>
                    <a href="{{ url_for("book",
                        book_url=flag.annotation.book.url) }}">
                        {{ flag.annotation.book.title }}
                    </a>
                </td>
                <td>
                    {{ flag.flag.flag }}
                </td>
                <td>
                    {{ flag.time_thrown }}
                </td>
                <td>
                    <a href="{{ url_for("user", user_id=flag.thrower.id) }}">
                        {{ flag.thrower.displayname }}
                    </a>
                </td>
                <td>
                    {% if flag.resolved_by %}
                        <a href="{{ url_for("user", user_id=flag.resolver.id)
                            }}">
                            {{ flag.resolver.displayname }}
                        </a>
                    {% endif %}
                </td>
                <td>
                    {% if flag.resolved %}
                        {{ flag.resolved }}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </table>
{% else %}
    <h3>Annotation has no flag history yet.</h3>
{% endif %}
{% endblock %}
