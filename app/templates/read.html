{% extends "base.html" %}

{% block content %}

    <!--Header/Running Head-->
    <div class="running_head">
        <a href="{{ url_for("book", book_url=book.url) }}">{{ book.title }}</a> 
         by <a href="{{ url_for("author", name=book.author.url) }}">
            {{ book.author.name }} </a>
    </div>

    {% if prev_page %}
        {% if tag %}
            <a href="{{ url_for("read_section", book_url=book.url, level=level,
                number=prev_page, tag=tag.tag) }}">Previous</a>
        {% else %}
            <a href="{{ url_for("read_section", book_url=book.url, level=level,
                number=prev_page) }}">Previous</a>
        {% endif %}
    {% endif %}

    {% if next_page %}
        {% if tag %}
            <a href="{{ url_for("read_section", book_url=book.url, level=level,
                number=next_page, tag=tag.tag) }}">Next</a>
        {% else %}
            <a href="{{ url_for("read_section", book_url=book.url, level=level,
                number=next_page) }}">Next</a>
        {% endif %}
    {% endif %}
    <form action="" method="POST">
        {{ form.hidden_tag() }}
        {{ form.first_line.label }}
        {{ form.first_line(size=1) }}
        {{ form.last_line.label }}
        {{ form.last_line(size=1) }}
        {{ form.submit() }}
    </form>
    {% if tags %}
        Limit to:
        {% for tag in tags %}
            <a href="{{ url_for("read_section", book_url=book.url,
                level=level, number=number, tag=tag.tag) }}">
                <tag>
                    {{ tag.tag }}
                </tag>
            </a>
        {% endfor %}
    {% else %}
        <a href="{{ url_for("read_section", book_url=book.url, level=level,
        number=number) }}">Show all tags</a>
    {% endif %}
            

    <hr>

    <content id="content">
        {%- for line in lines %}
            {%- include "_line.html" -%}
        {% endfor -%}
    </content>
    <!--Annotations-->
        {% for annotation in annotations %}
        {% if annotation.HEAD.last_line_num >= lines[0].l_num and annotation.HEAD.last_line_num <= lines[-1].l_num %}
            {% include "_annotation.html" %}
        {% endif %}
        {% endfor %}

    <hr>

    <!--Page Counter-->
    {% if prev_page %}
    <a href="{{ prev_page }}">Previous</a>
    {% endif %}
    {% if next_page %}
    <a href="{{ next_page }}">Next</a>
    {% endif %}

    <div class="running_head">
        <a href="{{ url_for("book", book_url=book.url) }}"> {{ book.title }}</a> 

         by <a href="{{ url_for("author", name=book.author.url) }}">
            {{ book.author.name }} </a>
    </div>


{% endblock %}
