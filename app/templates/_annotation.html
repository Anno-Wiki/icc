<annotation id="a{{ annotation.id }}">
<sup>
    <a href="{{ url_for("view_annotation", annotation_id=annotation.id) }}">
        [{{ annotation.id }}]
    </a>
</sup>
    on
    <em>
        <a href="#{{ annotation.HEAD.first_line_num }}">
            {% if annotation.HEAD.first_line_num == annotation.HEAD.last_line_num %}
                l.{{ annotation.HEAD.last_line_num }}
            {% else %}
                ll.{{ annotation.HEAD.first_line_num }}-{{ annotation.HEAD.last_line_num }}
            {% endif %}
        </a>
    </em>


    <div class="annotation_content">
    {% if len(annotation.HEAD.annotation) < 255 %}
        {{ annotation.HEAD.annotation|markdown }}
    {% else -%}
        <span class="cutoff">
        {{- annotation.HEAD.annotation[:255]|markdown -}}
        </span>
        <a href="{{ url_for("view_annotation", annotation_id=annotation.id) }}">
            View More
        </a>
    {% endif %}
    </div>
           


    <tags>
        {%- if annotation.HEAD.tag_1 != None -%}
        <a href="{{ url_for("tag", tag=annotation.HEAD.tag_1.tag) }}">
            <tag>{{ annotation.HEAD.tag_1.tag }}</tag>
        </a>
        {%- endif -%}

        {%- if annotation.HEAD.tag_2 != None -%}
        <a href="{{ url_for("tag", tag=annotation.HEAD.tag_2.tag) }}">
            <tag>{{ annotation.HEAD.tag_2.tag }}</tag>
        </a>
        {%- endif -%}

        {%- if annotation.HEAD.tag_3 != None -%}
        <a href="{{ url_for("tag", tag=annotation.HEAD.tag_3.tag) }}">
            <tag>{{ annotation.HEAD.tag_3.tag }}</tag>
        </a>
        {%- endif -%}

        {%- if annotation.HEAD.tag_4 != None -%}
        <a href="{{ url_for("tag", tag=annotation.HEAD.tag_4.tag) }}">
            <tag>{{ annotation.HEAD.tag_4.tag }}</tag>
        </a>
        {%- endif -%}

        {%- if annotation.HEAD.tag_5 != None -%}
        <a href="{{ url_for("tag", tag=annotation.HEAD.tag_5.tag) }}">
            <tag>{{ annotation.HEAD.tag_5.tag }}</tag>
        </a>
        {%- endif -%}
    </tags>

    <br>

    {% if annotation.HEAD.previous_id == None %}
        annotated by 
        <a href="{{ url_for("user", user_id=annotation.author.id) }}">
            {{ annotation.author.username }}
        </a>
        {{ annotation.author.reputation }},
    {% else %}
        last edited by 
        <a href="{{ url_for("user", user_id=annotation.HEAD.editor.id) }}">
            {{ annotation.HEAD.editor.username }}
        </a>
        {{ annotation.HEAD.editor.reputation }},
    {% endif %}

    {{ annotation.added }}

    |

    {% if uservotes and annotation.id in uservotes and uservotes[annotation.id] %}
        <a href="{{ url_for("upvote", anno_id=annotation.id, next=request.path) }}" class="voted">up</a>
    {% else %}
        <a href="{{ url_for("upvote", anno_id=annotation.id, next=request.path) }}" class="notvoted">up</a>
    {% endif %}

    /

    {% if uservotes and annotation.id in uservotes and not uservotes[annotation.id] %}
        <a href="{{ url_for("downvote", anno_id=annotation.id, next=request.path) }}" class="voted">down</a>
    {% else %}
        <a href="{{ url_for("downvote", anno_id=annotation.id, next=request.path) }}" class="notvoted">down</a>
    {% endif %}

    {% if annotation.weight > 0 %}

        {% if annotation.weight >= 1000000 %}
            <weight class="up">{{ round(annotation.weight / 1000000, 1) }}m</weight>
        {% elif annotation.weight >= 1000 %}
            <weight class="up">{{ round(annotation.weight / 1000, 1) }}k</weight>
        {% else %}
            <weight class="up">{{ annotation.weight }}</weight>
        {% endif %}

    {% elif annotation.weight == 0 %}

        <weight class="nil">{{ annotation.weight }}</weight>

    {% else %}

        {% if annotation.weight <= -1000000 %}
            <weight class="down">{{ round(annotation.weight / 1000000, 1) }}m</weight>
        {% elif annotation.weight <= -1000 %}
            <weight class="down">{{ round(annotation.weight / 1000, 1) }}k</weight>
        {% else %}
            <weight class="down">{{ annotation.weight }}</weight>
        {% endif %}

    {% endif %}

    | 

    <a href="{{ url_for("edit", anno_id=annotation.id, next=request.path) }}">edit</a>
</annotation>
